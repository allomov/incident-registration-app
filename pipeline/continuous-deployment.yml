---
resources:
- name: github-repository
  type: git
  source:
    uri: https://github.com/allomov/incident-registration-app.git
    branch: master

jobs:
- name: unit-tests
  plan:
  - get: github-repository
    trigger: true
  - task: unit-tests
    file: github-repository/pipeline/tasks/unit-tests.yml
- name: functional-tests
  plan:
  - get: github-repository
    trigger: true
  - task: functional-tests
    file: github-repository/pipeline/tasks/functional-tests.yml
- name: deploy-to-stagging-cf
  plan:
  - get: github-repository
    passed:
      - unit-tests
      - functional-tests
    trigger: true
  - task: deploy-to-stagging-cf
    file: github-repository/pipeline/tasks/deploy-to-staging.yml
- name: acceptance-tests
  plan:
  - get: github-repository
    passed: ["deploy-to-stagging-cf"]
    trigger: true
  - task: acceptance-tests
    file: github-repository/pipeline/tasks/acceptance-tests.yml
- name: blue-green-deployment-to-production-cf
  plan:
  - get: github-repository
    passed: ["acceptance-tests"]
    trigger: true
  - task: blue-green-deployment-to-production-cf
    file: github-repository/pipeline/tasks/deploy-to-production.yml

